{% extends "base.html" %}

{% block content %}
    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>Bem-vindo à Orlândia</h2>
            <p>Encontre informações, serviços e notícias sobre nossa cidade. Um governo transparente e próximo do cidadão.</p>
            <div class="search-box">
                <input type="text" placeholder="O que você está procurando?">
                <button><i class="fas fa-search"></i> Buscar</button>
            </div>
        </div>
    </section>

    <!-- Quick Access -->
    <section class="quick-access">
        <div class="container">
            <h3>Acesso Rápido</h3>
            <div class="quick-links">
                <a href="{{ url_for('licitacoes') }}" class="quick-link">Editais e Licitações</a>
                <a href="{{ url_for('concursos') }}" class="quick-link">Concursos Públicos</a>
                <a href="{{ url_for('iptu_online') }}" class="quick-link">IPTU Online</a>
                <a href="{{ url_for('alvaras') }}" class="quick-link">Alvarás</a>
            </div>
        </div>
    </section>

    <!-- Emergency Section -->
    <section class="container">
        <div class="emergency-container">
            <div class="emergency" id="emergencyPanel">
                <div class="emergency-header">
                    <h3><i class="fas fa-exclamation-triangle"></i> Serviços de Emergência</h3>
                </div>
                <p>Em caso de emergência, entre em contato com os serviços abaixo:</p>
                <div class="emergency-contacts">
                    <div class="emergency-contact">
                        <i class="fas fa-ambulance"></i>
                        <div>
                            <strong>SAMU</strong>
                            <div>192</div>
                        </div>
                    </div>
                    <div class="emergency-contact">
                        <i class="fas fa-fire-extinguisher"></i>
                        <div>
                            <strong>Bombeiros</strong>
                            <div>193</div>
                        </div>
                    </div>
                    <div class="emergency-contact">
                        <i class="fas fa-shield-alt"></i>
                        <div>
                            <strong>Polícia Militar</strong>
                            <div>190</div>
                        </div>
                    </div>
                    <div class="emergency-contact">
                        <i class="fas fa-hospital"></i>
                        <div>
                            <strong>Pronto Socorro</strong>
                            <div>(16) 3820-2000</div>
                        </div>
                    </div>
                </div>
            </div>
            <button
                type="button"
                class="emergency-toggle"
                data-js="emergency-toggle"
                aria-expanded="true"
                aria-controls="emergencyPanel"
                data-show-label="Mostrar contatos de emergência"
                data-hide-label="Ocultar contatos de emergência"
            >
                <span class="sr-only" data-js="emergency-toggle-label">Ocultar contatos de emergência</span>
                <i class="fas fa-chevron-up" aria-hidden="true" data-js="emergency-toggle-icon"></i>
            </button>
        </div>
    </section>

    {% set services_section = sections_map.get('services') %}
    {% if services_section %}
    <section class="services" id="{{ services_section.slug }}">
        <div class="container">
            <div class="section-title">
                <h2>{{ services_section.name }}</h2>
                {% if services_section.description %}
                <p>{{ services_section.description }}</p>
                {% endif %}
            </div>
            {% set service_items = services_section.items | selectattr('is_active') | list %}
            {% if service_items %}
            <div class="services-grid">
                {% for item in service_items %}
                <div class="service-card">
                    {% if item.icon_class %}
                    <div class="service-icon">
                        <i class="{{ item.icon_class }}"></i>
                    </div>
                    {% endif %}
                    <h3>{{ item.title }}</h3>
                    {% if item.summary %}
                    <p>{{ item.summary }}</p>
                    {% endif %}
                    {% set has_custom_link = item.link_url and item.link_url != '#' %}
                    {% if has_custom_link or item.id %}
                    <a href="{{ item.link_url if has_custom_link else url_for('home_item_detail', item_id=item.id) }}">{{ item.link_label or 'Acessar' }} <i class="fas fa-arrow-right"></i></a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>Sem serviços cadastrados no momento.</p>
            {% endif %}
        </div>
    </section>
    {% endif %}

    {% set news_section = sections_map.get('news') %}
    {% if news_section %}
    <section class="news" id="{{ news_section.slug }}">
        <div class="container">
            <div class="section-title">
                <h2>{{ news_section.name }}</h2>
                {% if news_section.description %}
                <p>{{ news_section.description }}</p>
                {% endif %}
            </div>
            {% set news_items = news_section.items | selectattr('is_active') | list %}
            {% if news_items %}
            <div class="news-grid">
                {% for item in news_items %}
                <div class="news-card">
                    {% if item.image_url %}
                    <div class="news-img">
                        <img src="{{ item.image_url }}" alt="{{ item.title }}">
                    </div>
                    {% endif %}
                    <div class="news-content">
                        {% if item.display_date %}
                        <div class="news-date">{{ item.display_date }}</div>
                        {% endif %}
                        <h3>{{ item.title }}</h3>
                        {% set summary_text = (item.summary or '') | striptags %}
                        {% if summary_text %}
                        <p class="news-summary" data-full-summary="{{ summary_text | e }}">{{ summary_text }}</p>
                        {% endif %}
                        {% set has_custom_link = item.link_url and item.link_url != '#' %}
                        {% if has_custom_link or item.id %}
                        <a class="news-read-more" href="{{ item.link_url if has_custom_link else url_for('news_detail', item_id=item.id) }}">{{ item.link_label or 'Leia mais' }} <i class="fas fa-arrow-right"></i></a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>Nenhuma notícia cadastrada até o momento.</p>
            {% endif %}
        </div>
    </section>
    {% endif %}

    {% set transparency_section = sections_map.get('transparency') %}
    {% if transparency_section %}
    <section class="transparency" id="{{ transparency_section.slug }}">
        <div class="container">
            <div class="section-title">
                <h2>{{ transparency_section.name }}</h2>
                {% if transparency_section.description %}
                <p>{{ transparency_section.description }}</p>
                {% endif %}
            </div>
            {% set transparency_items = transparency_section.items | selectattr('is_active') | list %}
            {% set transparency_links = {
                'Plano Plurianual': url_for('plano_plurianual'),
                'Relatórios de Gestão': url_for('relatorios_gestao'),
                'Gastos com COVID-19': url_for('gastos_covid19'),
                'Pesquisa de Satisfação': url_for('pesquisa_satisfacao'),
                'Lista de Obras': url_for('lista_obras'),
                'Iluminação Pública': url_for('iluminacao_publica')
            } %}
            {% if transparency_items %}
            <div class="transparency-grid">
                {% for item in transparency_items %}
                <div class="transparency-item">
                    {% if item.icon_class %}
                    <div class="transparency-icon">
                        <i class="{{ item.icon_class }}"></i>
                    </div>
                    {% endif %}
                    <h3>{{ item.title }}</h3>
                    {% if item.summary %}
                    <p>{{ item.summary }}</p>
                    {% endif %}
                    {% set has_custom_link = item.link_url and item.link_url != '#' %}
                    {% set fallback_link = transparency_links.get(item.title) %}
                    {% if has_custom_link or fallback_link %}
                    <a href="{{ item.link_url if has_custom_link else fallback_link }}">{{ item.link_label or 'Consultar' }}</a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>Transparência ainda não configurada.</p>
            {% endif %}
        </div>
    </section>
    {% endif %}

    {% for section in custom_sections %}
    <section class="services" id="{{ section.slug }}">
        <div class="container">
            <div class="section-title">
                <h2>{{ section.name }}</h2>
                {% if section.description %}
                <p>{{ section.description }}</p>
                {% endif %}
            </div>
            {% set custom_items = section.items | selectattr('is_active') | list %}
            {% if custom_items %}
            <div class="services-grid">
                {% for item in custom_items %}
                <div class="service-card">
                    {% if item.icon_class %}
                    <div class="service-icon">
                        <i class="{{ item.icon_class }}"></i>
                    </div>
                    {% endif %}
                    <h3>{{ item.title }}</h3>
                    {% if item.summary %}
                    <p>{{ item.summary }}</p>
                    {% endif %}
                    {% set has_custom_link = item.link_url and item.link_url != '#' %}
                    {% if has_custom_link or item.id %}
                    <a href="{{ item.link_url if has_custom_link else url_for('home_item_detail', item_id=item.id) }}">{{ item.link_label or 'Saiba mais' }} <i class="fas fa-arrow-right"></i></a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p>Nenhum item cadastrado ainda.</p>
            {% endif %}
        </div>
    </section>
    {% endfor %}
{% endblock %}
