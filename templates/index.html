{% extends "base.html" %}

{% block content %}
    <!-- Hero Section -->
    <section class="hero">
        <div class="container">
            <h2>Bem-vindo à Orlândia</h2>
            <p>Encontre informações, serviços e notícias sobre nossa cidade. Um governo transparente e próximo do cidadão.</p>
            <form class="search-box" action="{{ url_for('search') }}" method="get" role="search">
                <label class="sr-only" for="homepage-search">Buscar no site</label>
                <input
                    id="homepage-search"
                    type="search"
                    name="q"
                    placeholder="O que você está procurando?"
                    aria-label="Buscar no site"
                    required
                >
                <button type="submit"><i class="fas fa-search"></i> Buscar</button>
            </form>
        </div>
    </section>

    <!-- Quick Access -->
    <section class="quick-access">
        <div class="container">
            <h3>Acesso Rápido</h3>
            <div class="quick-links">
                <a href="{{ url_for('licitacoes') }}" class="quick-link">Editais e Licitações</a>
                <a href="{{ url_for('concursos') }}" class="quick-link">Concursos Públicos</a>
                <a href="{{ url_for('iptu_online') }}" class="quick-link">IPTU Online</a>
                <a href="{{ url_for('alvaras') }}" class="quick-link">Alvarás</a>
            </div>
        </div>
    </section>

    <!-- Emergency Section -->
    <section class="container">
        <div class="emergency-container">
            <div class="emergency" id="emergencyPanel">
                <div class="emergency-header">
                    <h3><i class="fas fa-exclamation-triangle"></i> Serviços de Emergência</h3>
                </div>
                <p>Em caso de emergência, entre em contato com os serviços abaixo:</p>
                {% if emergency_services %}
                <div class="emergency-contacts">
                    {% for service in emergency_services %}
                    <div class="emergency-contact">
                        <i class="{{ service.icon_class or 'fas fa-phone' }}" aria-hidden="true"></i>
                        <div>
                            <strong>{{ service.name }}</strong>
                            {% if service.phone %}
                            <div>{{ service.phone }}</div>
                            {% endif %}
                            {% if service.description %}
                            <div class="emergency-contact__description">{{ service.description }}</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="emergency-empty">Nenhum serviço de emergência cadastrado.</p>
                {% endif %}
            </div>
            <button
                type="button"
                class="emergency-toggle"
                data-js="emergency-toggle"
                aria-expanded="true"
                aria-controls="emergencyPanel"
                data-show-label="Mostrar contatos de emergência"
                data-hide-label="Ocultar contatos de emergência"
            >
                <span class="sr-only" data-js="emergency-toggle-label">Ocultar contatos de emergência</span>
                <i class="fas fa-chevron-up" aria-hidden="true" data-js="emergency-toggle-icon"></i>
            </button>
        </div>
    </section>

    {% for section in sections %}
        {% if section.section_type == 'services' %}
        <section class="services" id="{{ section.slug }}">
            <div class="container">
                <div class="section-title">
                    <h2>{{ section.name }}</h2>
                    {% if section.description %}
                    <p>{{ section.description }}</p>
                    {% endif %}
                </div>
                {% set service_items = section.items | selectattr('is_active') | list %}
                {% if service_items %}
                <div class="services-grid">
                    {% for item in service_items %}
                    <div class="service-card">
                        {% if item.image_url %}
                        <div class="service-media">
                            <img src="{{ item.image_url }}" alt="{{ item.title }}">
                        </div>
                        {% elif item.icon_class %}
                        <div class="service-icon">
                            <i class="{{ item.icon_class }}"></i>
                        </div>
                        {% endif %}
                        <h3>{{ item.title }}</h3>
                        {% if item.summary %}
                        <p>{{ item.summary }}</p>
                        {% endif %}
                        {% set has_custom_link = item.link_url and item.link_url != '#' %}
                        {% if has_custom_link or item.id %}
                        <a href="{{ item.link_url if has_custom_link else url_for('home_item_detail', item_id=item.id) }}">{{ item.link_label or 'Acessar' }} <i class="fas fa-arrow-right"></i></a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p>Sem serviços cadastrados no momento.</p>
                {% endif %}
            </div>
        </section>
        {% elif section.section_type == 'news' %}
        <section class="news" id="{{ section.slug }}">
            <div class="container">
                <div class="section-title">
                    <h2>{{ section.name }}</h2>
                    {% if section.description %}
                    <p>{{ section.description }}</p>
                    {% endif %}
                </div>
                {% set news_items = section.items | selectattr('is_active') | list %}
                {% if news_items %}
                <div class="news-grid">
                    {% for item in news_items %}
                    <div class="news-card">
                        {% if item.image_url %}
                        <div class="news-img">
                            <img src="{{ item.image_url }}" alt="{{ item.title }}">
                        </div>
                        {% endif %}
                        <div class="news-content">
                            {% if item.display_date %}
                            <div class="news-date">{{ item.display_date }}</div>
                            {% endif %}
                            <h3>{{ item.title }}</h3>
                            {% set summary_text = (item.summary or '') | striptags %}
                            {% if summary_text %}
                            <p class="news-summary" data-full-summary="{{ summary_text | e }}">{{ summary_text }}</p>
                            {% endif %}
                            {% set has_custom_link = item.link_url and item.link_url != '#' %}
                            {% if has_custom_link or item.id %}
                            <a class="news-read-more" href="{{ item.link_url if has_custom_link else url_for('news_detail', item_id=item.id) }}">{{ item.link_label or 'Leia mais' }} <i class="fas fa-arrow-right"></i></a>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p>Nenhuma notícia cadastrada até o momento.</p>
                {% endif %}
            </div>
        </section>
        {% elif section.section_type == 'transparency' %}
        <section class="transparency" id="{{ section.slug }}">
            <div class="container">
                <div class="section-title">
                    <h2>{{ section.name }}</h2>
                    {% if section.description %}
                    <p>{{ section.description }}</p>
                    {% endif %}
                </div>
                {% set transparency_items = section.items | selectattr('is_active') | list %}
                {% set transparency_links = {
                    'Plano Plurianual': url_for('plano_plurianual'),
                    'Relatórios de Gestão': url_for('relatorios_gestao'),
                    'Gastos com COVID-19': url_for('gastos_covid19'),
                    'Pesquisa de Satisfação': url_for('pesquisa_satisfacao'),
                    'Lista de Obras': url_for('lista_obras'),
                    'Iluminação Pública': url_for('iluminacao_publica')
                } %}
                {% if transparency_items %}
                <div class="transparency-grid">
                    {% for item in transparency_items %}
                    <div class="transparency-item">
                        {% if item.icon_class %}
                        <div class="transparency-icon">
                            <i class="{{ item.icon_class }}"></i>
                        </div>
                        {% endif %}
                        <h3>{{ item.title }}</h3>
                        {% if item.summary %}
                        <p>{{ item.summary }}</p>
                        {% endif %}
                        {% set has_custom_link = item.link_url and item.link_url != '#' %}
                        {% set fallback_link = transparency_links.get(item.title) %}
                        {% if has_custom_link or fallback_link %}
                        <a href="{{ item.link_url if has_custom_link else fallback_link }}">{{ item.link_label or 'Consultar' }}</a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p>Transparência ainda não configurada.</p>
                {% endif %}
            </div>
        </section>
        {% else %}
        <section class="services" id="{{ section.slug }}">
            <div class="container">
                <div class="section-title">
                    <h2>{{ section.name }}</h2>
                    {% if section.description %}
                    <p>{{ section.description }}</p>
                    {% endif %}
                </div>
                {% set custom_items = section.items | selectattr('is_active') | list %}
                {% if custom_items %}
                <div class="services-grid">
                    {% for item in custom_items %}
                    <div class="service-card">
                        {% if item.image_url %}
                        <div class="service-media">
                            <img src="{{ item.image_url }}" alt="{{ item.title }}">
                        </div>
                        {% elif item.icon_class %}
                        <div class="service-icon">
                            <i class="{{ item.icon_class }}"></i>
                        </div>
                        {% endif %}
                        <h3>{{ item.title }}</h3>
                        {% if item.summary %}
                        <p>{{ item.summary }}</p>
                        {% endif %}
                        {% set has_custom_link = item.link_url and item.link_url != '#' %}
                        {% if has_custom_link or item.id %}
                        <a href="{{ item.link_url if has_custom_link else url_for('home_item_detail', item_id=item.id) }}">{{ item.link_label or 'Saiba mais' }} <i class="fas fa-arrow-right"></i></a>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p>Nenhum item cadastrado ainda.</p>
                {% endif %}
            </div>
        </section>
        {% endif %}
    {% endfor %}
{% endblock %}
