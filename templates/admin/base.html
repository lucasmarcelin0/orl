<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        {% block title %}
            {% if admin_view.category %}{{ admin_view.category }} - {% endif %}
            {{ admin_view.name }} - {{ admin_view.admin.name }}
        {% endblock %}
    </title>

    {% block head_css %}
        <!-- Usar CDN diretamente -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/v4-shims.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
        
        <style>
            :root {
                --primary: #1a4f8c;
                --primary-dark: #12345d;
                --primary-light: #e8f1fb;
                --secondary: #2a9d8f;
                --danger: #e63946;
                --success: #27ae60;
                --warning: #f39c12;
                --background: #f8fafc;
                --sidebar-bg: #ffffff;
                --card-bg: #ffffff;
                --text: #2d3748;
                --text-light: #718096;
                --text-muted: #a0aec0;
                --border: #e2e8f0;
                --radius: 12px;
                --radius-sm: 8px;
                --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            * {
                box-sizing: border-box;
            }

            body,
            button,
            input,
            select,
            textarea {
                font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            }

            body {
                margin: 0;
                background: var(--background);
                color: var(--text);
                line-height: 1.6;
            }

            .fa,
            .fas,
            .fa-solid,
            .fa-regular,
            .fa-light,
            .fa-thin,
            .fa-duotone,
            .fa-brands {
                font-family: "Font Awesome 6 Free", "Font Awesome 6 Brands", "Font Awesome 5 Free", sans-serif !important;
                font-weight: 900;
                font-style: normal;
            }

            .fa-regular {
                font-weight: 400;
            }

            .fa-light,
            .fa-thin {
                font-weight: 300;
            }

            .fa-brands {
                font-family: "Font Awesome 6 Brands", "Font Awesome 5 Brands", sans-serif !important;
                font-weight: 400;
            }

            .cke_notification_warning,
            .cke_notification_warning * {
                display: none !important;
            }

            /* Header Styles */
            .cabecalho-admin {
                background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
                color: white;
                box-shadow: var(--shadow-lg);
                position: sticky;
                top: 0;
                z-index: 1000;
            }

            .cabecalho-admin__conteudo {
                max-width: 1400px;
                margin: 0 auto;
                padding: 1rem 2rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 2rem;
            }

            .cabecalho-admin__identificacao {
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .cabecalho-admin__logo {
                width: 40px;
                height: 40px;
                background: rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1.2rem;
            }

            .cabecalho-admin__titulo {
                margin: 0;
                font-size: 1.5rem;
                font-weight: 700;
                color: white;
            }

            .cabecalho-admin__subtitulo {
                font-size: 0.9rem;
                opacity: 0.9;
                margin: 0;
            }

            .cabecalho-admin__usuario {
                font-weight: 600;
                font-size: 0.95rem;
                opacity: 0.95;
            }

            .cabecalho-admin__acoes {
                display: flex;
                align-items: center;
                gap: 1.5rem;
            }

            .cabecalho-admin__menu-toggle {
                display: none;
                align-items: center;
                justify-content: center;
                width: 44px;
                height: 44px;
                border-radius: var(--radius-sm);
                border: 1px solid rgba(255, 255, 255, 0.3);
                background: rgba(255, 255, 255, 0.1);
                color: white;
                cursor: pointer;
                transition: var(--transition);
            }

            .cabecalho-admin__menu-toggle:focus {
                outline: none;
                box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
            }

            .cabecalho-admin__menu-toggle:hover {
                background: rgba(255, 255, 255, 0.2);
                transform: translateY(-1px);
            }

            /* Navigation Styles */
            .navegacao-admin {
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .navegacao-admin.is-open {
                display: flex;
            }

            .lista-navegacao {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .lista-navegacao + .lista-navegacao {
                margin-left: 1rem;
            }

            .lista-navegacao .dropdown {
                position: relative;
            }

            .lista-navegacao > li > a {
                color: rgba(255, 255, 255, 0.9);
                text-decoration: none;
                padding: 0.75rem 1rem;
                border-radius: var(--radius-sm);
                font-weight: 500;
                transition: var(--transition);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .lista-navegacao > li > a:hover,
            .lista-navegacao > li > a.active {
                background: rgba(255, 255, 255, 0.15);
                color: white;
                transform: translateY(-1px);
            }

            .lista-navegacao__item--destaque {
                margin-left: 0.5rem;
            }

            .lista-navegacao__botao {
                background: var(--secondary);
                color: white !important;
                padding: 0.75rem 1.5rem;
                border-radius: var(--radius);
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-weight: 600;
                box-shadow: 0 4px 12px rgba(42, 157, 143, 0.3);
                transition: var(--transition);
            }

            .lista-navegacao__botao:hover {
                background: #238f83;
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(42, 157, 143, 0.4);
                text-decoration: none;
            }

            .cabecalho-admin__atalho-site {
                background: rgba(255, 255, 255, 0.1);
                color: white;
                padding: 0.75rem 1.5rem;
                border-radius: var(--radius);
                text-decoration: none;
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                transition: var(--transition);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .cabecalho-admin__atalho-site:hover {
                background: rgba(255, 255, 255, 0.2);
                transform: translateY(-1px);
                text-decoration: none;
                color: white;
            }

            /* Main Content Styles */
            main {
                max-width: 1400px;
                margin: 2rem auto;
                padding: 0 2rem;
            }

            .dashboard-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 1.5rem;
                margin-bottom: 2rem;
            }

            .dashboard-card {
                background: var(--card-bg);
                border-radius: var(--radius);
                padding: 2rem;
                box-shadow: var(--shadow);
                border: 1px solid var(--border);
                transition: var(--transition);
            }

            .dashboard-card:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
            }

            .dashboard-card__header {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 1rem;
            }

            .dashboard-card__icon {
                width: 48px;
                height: 48px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.2rem;
            }

            .dashboard-card__icon--primary {
                background: var(--primary-light);
                color: var(--primary);
            }

            .dashboard-card__icon--success {
                background: rgba(39, 174, 96, 0.1);
                color: var(--success);
            }

            .dashboard-card__icon--warning {
                background: rgba(243, 156, 18, 0.1);
                color: var(--warning);
            }

            .dashboard-card__title {
                font-size: 1.1rem;
                font-weight: 600;
                margin: 0;
                color: var(--text);
            }

            .dashboard-card__value {
                font-size: 2rem;
                font-weight: 700;
                color: var(--primary);
                margin: 0.5rem 0;
            }

            .dashboard-card__description {
                color: var(--text-light);
                font-size: 0.9rem;
                margin: 0;
            }

            /* Quick Actions */
            .quick-actions {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin: 2rem 0;
            }

            .quick-action {
                background: var(--card-bg);
                padding: 1.5rem;
                border-radius: var(--radius);
                text-decoration: none;
                color: var(--text);
                border: 1px solid var(--border);
                transition: var(--transition);
                text-align: center;
            }

            .quick-action:hover {
                transform: translateY(-2px);
                box-shadow: var(--shadow-lg);
                text-decoration: none;
                color: var(--text);
                border-color: var(--primary);
            }

            .quick-action__icon {
                font-size: 2rem;
                color: var(--primary);
                margin-bottom: 1rem;
            }

            .quick-action__title {
                font-weight: 600;
                margin-bottom: 0.5rem;
            }

            .quick-action__description {
                color: var(--text-light);
                font-size: 0.85rem;
            }

            .list-buttons-column {
                display: flex;
                gap: 0.4rem;
                align-items: center;
            }

            .action-icon,
            .action-icon__button {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                width: 36px;
                height: 36px;
                border-radius: var(--radius-sm);
                border: 1px solid var(--border);
                background: var(--card-bg);
                color: var(--primary);
                transition: var(--transition);
                padding: 0;
                text-decoration: none;
            }

            .action-icon,
            .action-icon__button {
                color: var(--primary) !important;
            }

            .action-icon:hover,
            .action-icon:focus,
            .action-icon__button:hover,
            .action-icon__button:focus {
                background: var(--primary);
                color: #ffffff !important;
                border-color: var(--primary);
                text-decoration: none;
            }

            .action-icon__button {
                cursor: pointer;
            }

            .action-icon__button:focus-visible {
                outline: 2px solid var(--primary-light);
                outline-offset: 2px;
            }

            .action-icon__svg {
                width: 18px;
                height: 18px;
                fill: currentColor;
            }

            .action-icon-form {
                display: inline-flex;
                margin: 0;
            }

            /* Messages */
            .messages {
                display: flex;
                flex-direction: column;
                gap: 1rem;
                margin-bottom: 2rem;
            }

            .message {
                padding: 1rem 1.5rem;
                border-radius: var(--radius);
                border-left: 4px solid;
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .message.success {
                background: rgba(39, 174, 96, 0.1);
                border-color: var(--success);
                color: var(--success);
            }

            .message.error {
                background: rgba(230, 57, 70, 0.1);
                border-color: var(--danger);
                color: var(--danger);
            }

            .message.warning {
                background: rgba(243, 156, 18, 0.1);
                border-color: var(--warning);
                color: var(--warning);
            }

            /* Footer */
            footer {
                text-align: center;
                padding: 2rem;
                color: var(--text-muted);
                font-size: 0.9rem;
                border-top: 1px solid var(--border);
                margin-top: 3rem;
            }

            /* Dropdown Improvements */
            .dropdown-menu {
                border: none;
                box-shadow: var(--shadow-lg);
                border-radius: var(--radius);
                padding: 0.5rem;
            }

            .dropdown-item {
                padding: 0.75rem 1rem;
                border-radius: var(--radius-sm);
                font-weight: 500;
                transition: var(--transition);
            }

            .dropdown-item:hover {
                background: var(--primary-light);
                color: var(--primary);
            }

            .dropdown-menu {
                display: none;
                position: absolute;
                min-width: 220px;
                top: 100%;
                left: 0;
                margin-top: 0;
            }

            .dropdown:hover > .dropdown-menu,
            .dropdown-menu.is-open {
                display: block;
            }

            /* Responsive Design */
            @media (max-width: 1024px) {
                .cabecalho-admin__conteudo {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 1rem;
                }

                .cabecalho-admin__acoes {
                    width: 100%;
                    justify-content: space-between;
                }

                .navegacao-admin {
                    width: 100%;
                }

                .lista-navegacao {
                    flex-wrap: wrap;
                }
            }

            @media (max-width: 768px) {
                .cabecalho-admin__conteudo {
                    padding: 0.5rem 0.75rem;
                    gap: 0.75rem;
                }

                .cabecalho-admin__identificacao {
                    gap: 0.5rem;
                }

                .cabecalho-admin__logo {
                    width: 32px;
                    height: 32px;
                    font-size: 1rem;
                }

                .cabecalho-admin__titulo {
                    font-size: 1.05rem;
                }

                .cabecalho-admin__subtitulo {
                    font-size: 0.75rem;
                }

                .cabecalho-admin__usuario {
                    font-size: 0.8rem;
                }

                .cabecalho-admin__acoes {
                    align-items: center;
                    gap: 0.75rem;
                    flex-direction: row;
                    flex-wrap: wrap;
                    width: 100%;
                }

                .cabecalho-admin__menu-toggle {
                    display: flex;
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                }
                
                .cabecalho-admin__atalho-site {
                    order: 2;
                    width: auto;
                    padding: 0.5rem 1rem;
                    margin-left: auto;
                }

                .navegacao-admin {
                    order: 3;
                    display: none;
                    flex-direction: column;
                    gap: 0.75rem;
                    background: rgba(255, 255, 255, 0.12);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: var(--radius);
                    padding: 0.75rem;
                    width: 100%;
                    margin-top: 0.5rem;
                }

                .navegacao-admin.is-open {
                    display: flex;
                }

                .lista-navegacao {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 0.25rem;
                }

                .lista-navegacao + .lista-navegacao {
                    margin-left: 0;
                    border-top: 1px solid rgba(255, 255, 255, 0.2);
                    padding-top: 0.75rem;
                    margin-top: 0.75rem;
                }

                .lista-navegacao > li > a {
                    width: 100%;
                }

                .dropdown-menu {
                    position: static;
                    display: none;
                    background: rgba(0, 0, 0, 0.15);
                    border-radius: var(--radius-sm);
                    padding: 0.5rem 0;
                    margin-top: 0.5rem;
                    box-shadow: none;
                }

                .dropdown-menu.is-open {
                    display: block;
                }

                .dropdown-item {
                    color: rgba(255, 255, 255, 0.95);
                    padding-left: 2.5rem;
                }

                .cabecalho-admin__acoes {
                    align-items: stretch;
                }

                .cabecalho-admin__menu-toggle {
                    display: flex;
                }

                .navegacao-admin {
                    display: none;
                    flex-direction: column;
                    gap: 0.75rem;
                    background: rgba(255, 255, 255, 0.12);
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: var(--radius);
                    padding: 1rem;
                }

                .navegacao-admin.is-open {
                    display: flex;
                }

                .lista-navegacao {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 0.25rem;
                }

                .lista-navegacao + .lista-navegacao {
                    margin-left: 0;
                    border-top: 1px solid rgba(255, 255, 255, 0.2);
                    padding-top: 0.75rem;
                    margin-top: 0.75rem;
                }

                .lista-navegacao > li > a {
                    width: 100%;
                }

                .dropdown-menu {
                    position: static;
                    display: none;
                    background: rgba(0, 0, 0, 0.15);
                    border-radius: var(--radius-sm);
                    padding: 0.5rem 0;
                    margin-top: 0.5rem;
                    box-shadow: none;
                }

                .dropdown-menu.is-open {
                    display: block;
                }

                .dropdown-item {
                    color: rgba(255, 255, 255, 0.95);
                    padding-left: 2.5rem;
                }

                .cabecalho-admin__atalho-site {
                    width: 100%;
                    justify-content: center;
                }

                main {
                    padding: 0 1rem;
                }

                .dashboard-grid {
                    grid-template-columns: 1fr;
                }

            }

            @media (max-width: 480px) {
                .cabecalho-admin__titulo {
                    font-size: 1rem;
                }

                .cabecalho-admin__subtitulo {
                    font-size: 0.7rem;
                }

                .cabecalho-admin__usuario {
                    display: none;
                }

                .lista-navegacao > li > a {
                    padding: 0.5rem 0.75rem;
                    font-size: 0.9rem;
                }

                .dashboard-card {
                    padding: 1.5rem;
                }
            }

            /* Estilos específicos para o Flask-Admin */
            .admin-container {
                background: white;
                border-radius: var(--radius);
                padding: 2rem;
                box-shadow: var(--shadow);
                margin-top: 2rem;
            }

            /* Filtros avançados */
            #filter_form {
                background: #f8fafd;
                border: 1px solid var(--border);
                border-radius: var(--radius);
                padding: 1.25rem 1.5rem;
                margin-bottom: 1.5rem;
                box-shadow: 0 10px 30px rgba(16, 42, 84, 0.08);
            }

            #filter_form .filters {
                width: 100%;
            }

            #filter_form .filters tr {
                display: flex;
                flex-wrap: wrap;
                gap: 0.75rem;
                align-items: center;
                margin-bottom: 0.75rem;
            }

            #filter_form .filters tr:last-child {
                margin-bottom: 0;
            }

            #filter_form .filters td {
                border: 0;
                padding: 0;
            }

            #filter_form .filters .remove-filter {
                display: inline-flex;
                align-items: center;
                gap: 0.35rem;
                background: rgba(26, 79, 140, 0.1);
                color: var(--primary);
                border-radius: 999px;
                padding: 0.45rem 0.9rem;
                font-weight: 600;
                transition: var(--transition);
            }

            #filter_form .filters .remove-filter:hover,
            #filter_form .filters .remove-filter:focus {
                background: var(--primary);
                color: #ffffff;
                text-decoration: none;
            }

            #filter_form .filters .remove-filter .close-icon {
                font-size: 1rem;
                line-height: 1;
            }

            #filter_form .filters select,
            #filter_form .filters input.filter-val {
                min-width: 220px;
                border-radius: var(--radius-sm);
                border: 1px solid var(--border);
                background: #ffffff;
                padding: 0.55rem 0.75rem;
                font-size: 0.95rem;
                transition: var(--transition);
            }

            #filter_form .filters input.filter-val:focus,
            #filter_form .filters select:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(26, 79, 140, 0.12);
                outline: none;
            }

            #filter_form .btn {
                border-radius: var(--radius-sm);
                font-weight: 600;
                padding: 0.6rem 1.25rem;
            }

            #filter_form .btn.btn-primary {
                background: var(--primary);
                border: none;
                box-shadow: 0 12px 20px rgba(26, 79, 140, 0.18);
            }

            #filter_form .btn.btn-secondary {
                border: 1px solid rgba(26, 79, 140, 0.2);
                color: var(--primary);
                background: #ffffff;
            }

            #filter_form .btn.btn-secondary:hover,
            #filter_form .btn.btn-secondary:focus {
                background: var(--primary-light);
                border-color: var(--primary);
                color: var(--primary);
            }

            #filter_form .select2-container--default .select2-selection--single {
                height: auto;
                border: 1px solid var(--border);
                border-radius: var(--radius-sm);
                padding: 0.35rem 0.75rem;
                display: flex;
                align-items: center;
            }

            #filter_form .select2-selection__rendered {
                font-size: 0.95rem;
                color: var(--text);
            }

            #filter_form .select2-selection__arrow {
                height: 100%;
                right: 0.5rem;
            }

            #filter_form .select2-container--default.select2-container--open .select2-selection--single {
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(26, 79, 140, 0.12);
            }

            #filter_form .select2-dropdown {
                border: 1px solid var(--border);
                box-shadow: 0 16px 40px rgba(15, 32, 63, 0.12);
                border-radius: var(--radius);
                overflow: hidden;
            }

            #filter_form .select2-results__option--highlighted {
                background: var(--primary-light) !important;
                color: var(--primary) !important;
            }

            .table {
                border-radius: var(--radius);
                overflow: hidden;
                box-shadow: var(--shadow);
            }

            .table th {
                background: var(--primary-light);
                color: var(--primary);
                font-weight: 600;
                border: none;
                padding: 1rem;
            }

            .table td {
                padding: 1rem;
                border-color: var(--border);
                vertical-align: middle;
            }

            .btn-primary {
                background: var(--primary);
                border: none;
                border-radius: var(--radius-sm);
                padding: 0.75rem 1.5rem;
                font-weight: 600;
                transition: var(--transition);
                color: #ffffff;
            }

            .btn .fa,
            .btn .fas,
            .btn .fa-solid,
            .btn .fa-regular,
            .btn .fa-light,
            .btn .fa-thin,
            .btn .fa-duotone,
            .btn .fa-brands {
                color: inherit;
            }

            .btn-primary:hover {
                background: var(--primary-dark);
                transform: translateY(-1px);
                box-shadow: 0 4px 12px rgba(26, 79, 140, 0.3);
            }

            /* Menu navigation styles */
            .navegacao-admin .nav-link {
                color: rgba(255, 255, 255, 0.9) !important;
                text-decoration: none;
                padding: 0.75rem 1rem;
                border-radius: var(--radius-sm);
                font-weight: 500;
                transition: var(--transition);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .navegacao-admin .nav-link:hover,
            .navegacao-admin .nav-link.active {
                background: rgba(255, 255, 255, 0.15);
                color: white !important;
                transform: translateY(-1px);
                text-decoration: none;
            }
        </style>
    {% endblock %}

    {% block head %}{% endblock %}
    {% block head_tail %}{% endblock %}
</head>
<body>
{% set render_ctx = h.resolve_ctx() %}
{% block page_body %}
    <header class="cabecalho-admin">
        <div class="cabecalho-admin__conteudo">
            <div class="cabecalho-admin__identificacao">
                <div class="cabecalho-admin__logo">
                    <i class="fa-solid fa-landmark"></i>
                </div>
                <div>
                    <h1 class="cabecalho-admin__titulo">Prefeitura de Orlândia</h1>
                    <p class="cabecalho-admin__subtitulo">Painel Administrativo</p>
                </div>
            </div>
            
            {% if current_user.is_authenticated %}
                <span class="cabecalho-admin__usuario">Olá, {{ current_user.name }}</span>
            {% endif %}
            
            <div class="cabecalho-admin__acoes">
                <button class="cabecalho-admin__menu-toggle" type="button" aria-label="Alternar navegação" aria-expanded="false">
                    <i class="fa-solid fa-bars" aria-hidden="true"></i>
                </button>
                <nav class="navegacao-admin" aria-label="Navegação principal do painel">
                    <ul class="lista-navegacao">
                        <!-- Menu principal simplificado -->
                        <li>
                            <a class="nav-link" href="/admin/">
                                <i class="fa-solid fa-house"></i>
                                Home
                            </a>
                        </li>
                        
                        <li class="dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                                <i class="fa-solid fa-file-lines"></i>
                                Conteúdo
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="/admin/page/">
                                    <i class="fa-solid fa-file-invoice"></i>
                                    Páginas institucionais
                                </a>
                            </div>
                        </li>
                        
                        <li class="dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                                <i class="fa-solid fa-table-cells-large"></i>
                                Página inicial
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="/admin/homepagesection/">
                                    <i class="fa-solid fa-layer-group"></i>
                                    Seções da página
                                </a>
                                <a class="dropdown-item" href="/admin/sectionitem/">
                                    <i class="fa-solid fa-cube"></i>
                                    Itens das seções
                                </a>
                                <a class="dropdown-item" href="/admin/document/">
                                    <i class="fa-solid fa-file-pdf"></i>
                                    Documentos
                                </a>
                                <a class="dropdown-item" href="/admin/footercolumn/">
                                    <i class="fa-solid fa-table-columns"></i>
                                    Colunas do rodapé
                                </a>
                                <a class="dropdown-item" href="/admin/quicklink/">
                                    <i class="fa-solid fa-link"></i>
                                    Acesso rápido
                                </a>
                                <a class="dropdown-item" href="/admin/emergencyservice/">
                                    <i class="fa-solid fa-phone-flip"></i>
                                    Serviços de emergência
                                </a>
                            </div>
                        </li>
                        
                        <li class="dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown">
                                <i class="fa-solid fa-users"></i>
                                Equipe
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="/admin/user/">
                                    <i class="fa-solid fa-user-gear"></i>
                                    Usuários do sistema
                                </a>
                            </div>
                        </li>
                        
                        {% if current_user.is_authenticated and current_user.is_admin %}
                            <li class="lista-navegacao__item--destaque">
                                <a class="lista-navegacao__botao" href="/admin/user/new/">
                                    <i class="fa-solid fa-user-plus" aria-hidden="true"></i>
                                    Novo Colaborador
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                    
                    <!-- Menu de conta -->
                    <ul class="lista-navegacao">
                        {% if current_user.is_authenticated %}
                            <li>
                                <a class="nav-link" href="/admin/perfil">
                                    <i class="fa-solid fa-user"></i>
                                    Meu Perfil
                                </a>
                            </li>
                            <li>
                                <a class="nav-link" href="/auth/logout">
                                    <i class="fa-solid fa-right-from-bracket"></i>
                                    Sair
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </nav>
                
                <a class="cabecalho-admin__atalho-site" href="{{ url_for('index') }}" target="_blank" rel="noopener">
                    <i class="fa-solid fa-up-right-from-square" aria-hidden="true"></i>
                    Ver Site
                </a>
            </div>
        </div>
    </header>

    <main>
        {% block messages %}
            <div class="messages">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="message {{ category }}">
                                <i class="fa-solid {% if category == 'success' %}fa-circle-check{% elif category == 'error' %}fa-circle-exclamation{% else %}fa-circle-info{% endif %}"></i>
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>
        {% endblock %}

        <!-- Dashboard Overview - Apenas na página inicial -->
        {% if request.path == '/admin/' %}
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="dashboard-card__header">
                    <div class="dashboard-card__icon dashboard-card__icon--primary">
                        <i class="fa-solid fa-file-lines"></i>
                    </div>
                    <div>
                        <h3 class="dashboard-card__title">Conteúdo Publicado</h3>
                        <p class="dashboard-card__description">Total de páginas ativas</p>
                    </div>
                </div>
                <div class="dashboard-card__value">4</div>
                <p class="dashboard-card__description">Páginas visíveis no site</p>
            </div>

            <div class="dashboard-card">
                <div class="dashboard-card__header">
                    <div class="dashboard-card__icon dashboard-card__icon--success">
                        <i class="fa-solid fa-layer-group"></i>
                    </div>
                    <div>
                        <h3 class="dashboard-card__title">Seções Ativas</h3>
                        <p class="dashboard-card__description">Na página inicial</p>
                    </div>
                </div>
                <div class="dashboard-card__value">5</div>
                <p class="dashboard-card__description">Seções configuradas</p>
            </div>

            <div class="dashboard-card">
                <div class="dashboard-card__header">
                    <div class="dashboard-card__icon dashboard-card__icon--warning">
                        <i class="fa-solid fa-calendar-check"></i>
                    </div>
                    <div>
                        <h3 class="dashboard-card__title">Última Atualização</h3>
                        <p class="dashboard-card__description">Da página inicial</p>
                    </div>
                </div>
                <div class="dashboard-card__value">31/10</div>
                <p class="dashboard-card__description">Última edição realizada</p>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <a href="/admin/page/" class="quick-action">
                <div class="quick-action__icon">
                    <i class="fa-solid fa-file-invoice"></i>
                </div>
                <h4 class="quick-action__title">Páginas</h4>
                <p class="quick-action__description">Gerenciar páginas institucionais</p>
            </a>

            <a href="/admin/homepagesection/" class="quick-action">
                <div class="quick-action__icon">
                    <i class="fa-solid fa-table-cells-large"></i>
                </div>
                <h4 class="quick-action__title">Seções</h4>
                <p class="quick-action__description">Configurar seções da home</p>
            </a>

            <a href="/admin/document/" class="quick-action">
                <div class="quick-action__icon">
                    <i class="fa-solid fa-file-pdf"></i>
                </div>
                <h4 class="quick-action__title">Documentos</h4>
                <p class="quick-action__description">Publicar novos documentos</p>
            </a>

            <a href="/admin/user/" class="quick-action">
                <div class="quick-action__icon">
                    <i class="fa-solid fa-users"></i>
                </div>
                <h4 class="quick-action__title">Usuários</h4>
                <p class="quick-action__description">Gerenciar colaboradores</p>
            </a>
        </div>
        {% endif %}

        <!-- Conteúdo específico do Flask-Admin -->
        <div class="admin-container">
            {% block body %}{% endblock %}
        </div>
    </main>

    <footer>
        <p>Painel administrativo destinado aos colaboradores autorizados da Prefeitura Municipal de Orlândia.</p>
        <p>&copy; 2024 Prefeitura de Orlândia. Todos os direitos reservados.</p>
    </footer>
{% endblock %}

    {% block tail_js %}
        <!-- Usar CDN para jQuery e Bootstrap -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="{{ url_for('admin.static', filename='vendor/moment.min.js') }}"></script>
        <script src="{{ url_for('admin.static', filename='vendor/select2/select2.min.js') }}"></script>
        <script src="{{ url_for('admin.static', filename='admin/js/helpers.js') }}"></script>

        {% if ckeditor %}
            {{ ckeditor.load() }}
            <script src="{{ url_for('static', filename='js/admin/ckeditor-enhancements.js') }}"></script>
        {% endif %}
        
        <!-- Custom JavaScript for enhanced interactions -->
        <script>
            const enhanceFilterForm = () => {
                const filterForm = document.getElementById('filter_form');
                if (!filterForm || !window.jQuery || filterForm.dataset.filtersEnhanced === '1') {
                    return;
                }

                const $ = window.jQuery;
                const filterTable = filterForm.querySelector('.filters');
                if (!filterTable) {
                    return;
                }

                const setupRow = row => {
                    const valueField = row.querySelector('.filter-val');
                    if (!valueField) {
                        return;
                    }

                    if (valueField.tagName === 'SELECT') {
                        const removeButton = row.querySelector('.remove-filter');
                        const labelText = removeButton ? removeButton.textContent.trim() : '';
                        const isSectionFilter = /seção/i.test(labelText);
                        const placeholder = isSectionFilter
                            ? 'Selecione a seção desejada'
                            : 'Selecione uma opção';

                        valueField.setAttribute('data-allow-blank', '1');
                        valueField.setAttribute('data-placeholder', placeholder);

                        const $select = $(valueField);
                        if ($select.data('select2')) {
                            $select.select2('destroy');
                        }

                        $select.select2({
                            width: 'resolve',
                            placeholder,
                            allowClear: true,
                        });

                        setTimeout(() => {
                            if ($select.data('select2') && !$select.val()) {
                                $select.select2('open');
                            }
                        }, 80);
                    } else {
                        if (!valueField.getAttribute('placeholder')) {
                            valueField.setAttribute('placeholder', 'Digite o valor desejado');
                        }
                        valueField.focus();
                    }
                };

                const existingRows = filterTable.querySelectorAll('tr');
                existingRows.forEach(row => setupRow(row));

                const observer = new MutationObserver(mutations => {
                    mutations.forEach(mutation => {
                        mutation.addedNodes.forEach(node => {
                            if (node.nodeType === Node.ELEMENT_NODE) {
                                setupRow(node);
                            }
                        });
                    });
                });

                observer.observe(filterTable, { childList: true });
                filterForm.dataset.filtersEnhanced = '1';
            };

            if (window.jQuery) {
                window.jQuery(document).on('adminFormReady', enhanceFilterForm);
            } else {
                document.addEventListener('DOMContentLoaded', () => {
                    if (window.jQuery) {
                        window.jQuery(document).on('adminFormReady', enhanceFilterForm);
                    }
                });
            }

            document.addEventListener('DOMContentLoaded', function() {
                // Add smooth animations to cards
                const cards = document.querySelectorAll('.dashboard-card, .quick-action');
                cards.forEach(card => {
                    card.style.opacity = '0';
                    card.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        card.style.transition = 'all 0.6s ease';
                        card.style.opacity = '1';
                        card.style.transform = 'translateY(0)';
                    }, 100);
                });

                // Mobile navigation toggle
                const menuToggle = document.querySelector('.cabecalho-admin__menu-toggle');
                const navigation = document.querySelector('.navegacao-admin');

                const closeMobileDropdowns = () => {
                    document.querySelectorAll('.dropdown-menu.is-open').forEach(openMenu => {
                        openMenu.classList.remove('is-open');
                        const parentDropdown = openMenu.closest('.dropdown');
                        const parentToggle = parentDropdown ? parentDropdown.querySelector('.dropdown-toggle') : null;
                        if (parentToggle) {
                            parentToggle.setAttribute('aria-expanded', 'false');
                        }
                    });
                };

                if (menuToggle && navigation) {
                    menuToggle.addEventListener('click', () => {
                        const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
                        menuToggle.setAttribute('aria-expanded', (!isExpanded).toString());
                        navigation.classList.toggle('is-open');

                        if (isExpanded) {
                            closeMobileDropdowns();
                        }
                    });

                    window.addEventListener('resize', () => {
                        if (window.innerWidth > 768) {
                            navigation.classList.remove('is-open');
                            menuToggle.setAttribute('aria-expanded', 'false');
                            closeMobileDropdowns();
                        }
                    });
                }

                // Enhanced dropdown interactions
                const dropdowns = document.querySelectorAll('.dropdown');
                dropdowns.forEach(dropdown => {
                    const toggle = dropdown.querySelector('.dropdown-toggle');
                    const menu = dropdown.querySelector('.dropdown-menu');
                    if (!toggle || !menu) {
                        return;
                    }

                    toggle.setAttribute('aria-haspopup', 'true');
                    toggle.setAttribute('aria-expanded', 'false');

                    let hoverTimeout = null;

                    const cancelScheduledClose = () => {
                        if (hoverTimeout) {
                            clearTimeout(hoverTimeout);
                            hoverTimeout = null;
                        }
                    };

                    const openMenu = () => {
                        menu.classList.add('is-open');
                        toggle.setAttribute('aria-expanded', 'true');
                    };

                    const closeMenu = () => {
                        menu.classList.remove('is-open');
                        toggle.setAttribute('aria-expanded', 'false');
                    };

                    const scheduleClose = () => {
                        cancelScheduledClose();
                        hoverTimeout = setTimeout(() => {
                            if (window.innerWidth > 768) {
                                closeMenu();
                            }
                        }, 120);
                    };

                    dropdown.addEventListener('mouseenter', function() {
                        if (window.innerWidth > 768) {
                            cancelScheduledClose();
                            openMenu();
                        }
                    });

                    dropdown.addEventListener('mouseleave', function() {
                        if (window.innerWidth > 768) {
                            scheduleClose();
                        }
                    });

                    menu.addEventListener('mouseenter', () => {
                        if (window.innerWidth > 768) {
                            cancelScheduledClose();
                        }
                    });

                    menu.addEventListener('mouseleave', () => {
                        if (window.innerWidth > 768) {
                            scheduleClose();
                        }
                    });

                    toggle.addEventListener('click', event => {
                        if (window.innerWidth <= 768) {
                            event.preventDefault();
                            const isOpen = menu.classList.contains('is-open');

                            closeMobileDropdowns();

                            if (!isOpen) {
                                openMenu();
                            } else {
                                closeMenu();
                            }
                        }
                    });
                });

                // Melhorar a aparência das tabelas do Flask-Admin
                const tables = document.querySelectorAll('.table');
                tables.forEach(table => {
                    table.classList.add('table-hover');
                });

                // Marcar link ativo no menu
                const currentPath = window.location.pathname;
                const navLinks = document.querySelectorAll('.nav-link');
                navLinks.forEach(link => {
                    if (link.getAttribute('href') === currentPath) {
                        link.classList.add('active');
                    }
                });
                enhanceFilterForm();
            });
        </script>
    {% endblock %}

{% block tail %}{% endblock %}
</body>
</html>
