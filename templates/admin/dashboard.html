{% extends 'admin/base.html' %}

{% block title %}Construtor da P√°gina Inicial{% endblock %}

{% block content %}
<div class="card" style="margin-bottom: 32px; display: flex; flex-direction: column; gap: 24px;">
    <header>
        <h2 style="margin: 0;">Informa√ß√µes gerais da p√°gina</h2>
        <p style="margin: 8px 0 0; color: var(--muted);">
            Defina t√≠tulo, descri√ß√£o e organize os blocos que comp√µem a p√°gina inicial. Os dados s√£o gravados em um arquivo JSON e
            podem ser restaurados pelos backups autom√°ticos.
        </p>
        <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-top: 16px; color: var(--muted); font-size: 0.95rem;">
            <div>
                <strong>√öltima atualiza√ß√£o:</strong>
                {% if last_modified %}
                    {{ last_modified.strftime('%d/%m/%Y %H:%M') }}
                {% else %}
                    Ainda n√£o registrada.
                {% endif %}
            </div>
            <div>
                <strong>√öltimo backup:</strong>
                {% if last_backup %}
                    {{ last_backup.name }}
                {% else %}
                    Ainda n√£o dispon√≠vel.
                {% endif %}
            </div>
        </div>
    </header>

    <form method="post" style="display: flex; flex-direction: column; gap: 16px;">
        <input type="hidden" name="action" value="update_page">
        <label for="page_title" style="font-weight: 600;">T√≠tulo exibido na aba do navegador</label>
        <input
            id="page_title"
            name="page_title"
            type="text"
            value="{{ page.title }}"
            required
            style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;"
        >

        <label for="page_description" style="font-weight: 600;">Descri√ß√£o breve (usada em compartilhamentos)</label>
        <textarea
            id="page_description"
            name="page_description"
            rows="3"
            style="width: 100%; padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">{{ page.description }}</textarea>

        <button
            type="submit"
            style="align-self: flex-start; padding: 12px 18px; background: var(--primary); color: white; border: none; border-radius: var(--radius); font-size: 1rem; font-weight: 600; cursor: pointer;"
        >Salvar informa√ß√µes gerais</button>
    </form>
</div>

<div class="card" style="margin-bottom: 32px;">
    <h3 style="margin-top: 0;">Adicionar novos blocos</h3>
    <p style="margin-top: 8px; color: var(--muted);">
        Escolha um modelo de bloco. Ap√≥s adicionar ele aparecer√° na lista para personaliza√ß√£o.
    </p>
    <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 16px;">
        {% for type, label, description in [
            ('hero', 'Destaque com banner', '√Årea com imagem de fundo e bot√µes de a√ß√£o.'),
            ('text', 'Texto livre', 'T√≠tulo e par√°grafos alinhados.'),
            ('image', 'Imagem com texto', 'Bloco ilustrado com link opcional.'),
            ('list', 'Lista de links', 'Links separados por linha para atalhos.'),
            ('cta', 'Chamada para a√ß√£o', 'T√≠tulo, texto e bot√£o de destaque.'),
            ('custom', 'Bloco personalizado', 'Permite colar HTML pr√≥prio.')
        ] %}
        <form method="post" style="flex: 1 1 220px; min-width: 220px; border: 1px solid #d3d8e6; border-radius: var(--radius); padding: 16px; display: flex; flex-direction: column; gap: 12px; background: #f9fbff;">
            <input type="hidden" name="action" value="add_section">
            <button
                type="submit"
                name="section_type"
                value="{{ type }}"
                style="text-align: left; background: none; border: none; padding: 0; font-size: 1.05rem; font-weight: 600; color: var(--primary); cursor: pointer;"
            >{{ label }}</button>
            <span style="color: var(--muted); font-size: 0.9rem;">{{ description }}</span>
        </form>
        {% endfor %}
    </div>
</div>

{% for section in sections %}
    <div class="card" style="margin-bottom: 32px; display: flex; flex-direction: column; gap: 16px;">
        <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center; justify-content: space-between;">
            <div>
                <span style="display: inline-flex; align-items: center; gap: 8px; font-weight: 600;">
                    {{ section.title or 'Bloco sem t√≠tulo' }}
                    <small style="padding: 4px 8px; background: #eef3ff; color: var(--primary); border-radius: 999px; text-transform: uppercase; font-size: 0.7rem; letter-spacing: 0.05em;">{{ section.type }}</small>
                </span>
            </div>
            <div style="display: flex; gap: 8px;">
                <form method="post" style="margin: 0;">
                    <input type="hidden" name="action" value="move_up">
                    <input type="hidden" name="section_id" value="{{ section.id }}">
                    <button type="submit" title="Mover para cima" style="border: 1px solid #d3d8e6; background: white; padding: 8px 12px; border-radius: var(--radius); cursor: pointer;">‚¨ÜÔ∏è</button>
                </form>
                <form method="post" style="margin: 0;">
                    <input type="hidden" name="action" value="move_down">
                    <input type="hidden" name="section_id" value="{{ section.id }}">
                    <button type="submit" title="Mover para baixo" style="border: 1px solid #d3d8e6; background: white; padding: 8px 12px; border-radius: var(--radius); cursor: pointer;">‚¨áÔ∏è</button>
                </form>
                <form method="post" style="margin: 0;" onsubmit="return confirm('Tem certeza que deseja remover este bloco?');">
                    <input type="hidden" name="action" value="delete_section">
                    <input type="hidden" name="section_id" value="{{ section.id }}">
                    <button type="submit" title="Remover bloco" style="border: 1px solid #d3d8e6; background: white; padding: 8px 12px; border-radius: var(--radius); cursor: pointer; color: var(--danger);">üóëÔ∏è</button>
                </form>
            </div>
        </div>

        <form method="post" style="display: flex; flex-direction: column; gap: 16px;">
            <input type="hidden" name="action" value="update_section">
            <input type="hidden" name="section_id" value="{{ section.id }}">

            <label style="font-weight: 600;" for="title-{{ section.id }}">T√≠tulo do bloco</label>
            <input
                id="title-{{ section.id }}"
                type="text"
                name="title"
                value="{{ section.title }}"
                style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;"
            >

            {% if section.type == 'hero' %}
                <div style="display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="subtitle-{{ section.id }}" style="font-weight: 600;">Subt√≠tulo</label>
                        <textarea id="subtitle-{{ section.id }}" name="subtitle" rows="3" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">{{ section.subtitle }}</textarea>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="background_image-{{ section.id }}" style="font-weight: 600;">Imagem de fundo (URL)</label>
                        <input id="background_image-{{ section.id }}" type="url" name="background_image" value="{{ section.background_image }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                </div>

                <div style="display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="font-weight: 600;" for="primary_text-{{ section.id }}">Texto do bot√£o principal</label>
                        <input id="primary_text-{{ section.id }}" type="text" name="primary_text" value="{{ section.primary_text }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="font-weight: 600;" for="primary_url-{{ section.id }}">Link do bot√£o principal</label>
                        <input id="primary_url-{{ section.id }}" type="url" name="primary_url" value="{{ section.primary_url }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="font-weight: 600;" for="secondary_text-{{ section.id }}">Texto do bot√£o secund√°rio</label>
                        <input id="secondary_text-{{ section.id }}" type="text" name="secondary_text" value="{{ section.secondary_text }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label style="font-weight: 600;" for="secondary_url-{{ section.id }}">Link do bot√£o secund√°rio</label>
                        <input id="secondary_url-{{ section.id }}" type="url" name="secondary_url" value="{{ section.secondary_url }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                </div>
            {% elif section.type == 'text' %}
                <label for="body-{{ section.id }}" style="font-weight: 600;">Conte√∫do</label>
                <textarea id="body-{{ section.id }}" name="body" rows="6" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">{{ section.body }}</textarea>

                <label for="alignment-{{ section.id }}" style="font-weight: 600;">Alinhamento</label>
                <select id="alignment-{{ section.id }}" name="alignment" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    {% for value, label in [('left', 'Esquerda'), ('center', 'Centralizado'), ('right', 'Direita')] %}
                        <option value="{{ value }}" {% if section.alignment == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            {% elif section.type == 'image' %}
                <label for="body-{{ section.id }}" style="font-weight: 600;">Descri√ß√£o</label>
                <textarea id="body-{{ section.id }}" name="body" rows="4" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">{{ section.body }}</textarea>

                <div style="display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="image_url-{{ section.id }}" style="font-weight: 600;">URL da imagem</label>
                        <input id="image_url-{{ section.id }}" type="url" name="image_url" value="{{ section.image_url }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="image_alt-{{ section.id }}" style="font-weight: 600;">Texto alternativo</label>
                        <input id="image_alt-{{ section.id }}" type="text" name="image_alt" value="{{ section.image_alt }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                </div>

                <div style="display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="link_text-{{ section.id }}" style="font-weight: 600;">Texto do link</label>
                        <input id="link_text-{{ section.id }}" type="text" name="link_text" value="{{ section.link_text }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="link_url-{{ section.id }}" style="font-weight: 600;">URL do link</label>
                        <input id="link_url-{{ section.id }}" type="url" name="link_url" value="{{ section.link_url }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                </div>

                <label for="alignment-{{ section.id }}" style="font-weight: 600;">Posi√ß√£o da imagem</label>
                <select id="alignment-{{ section.id }}" name="alignment" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    {% for value, label in [('left', 'Imagem √† esquerda'), ('right', 'Imagem √† direita'), ('center', 'Centralizada')] %}
                        <option value="{{ value }}" {% if section.alignment == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                </select>
            {% elif section.type == 'cta' %}
                <label for="body-{{ section.id }}" style="font-weight: 600;">Descri√ß√£o</label>
                <textarea id="body-{{ section.id }}" name="body" rows="4" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">{{ section.body }}</textarea>

                <div style="display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));">
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="button_text-{{ section.id }}" style="font-weight: 600;">Texto do bot√£o</label>
                        <input id="button_text-{{ section.id }}" type="text" name="button_text" value="{{ section.button_text }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <label for="button_url-{{ section.id }}" style="font-weight: 600;">Link do bot√£o</label>
                        <input id="button_url-{{ section.id }}" type="url" name="button_url" value="{{ section.button_url }}" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">
                    </div>
                </div>
            {% elif section.type == 'list' %}
                <label for="body-{{ section.id }}" style="font-weight: 600;">Descri√ß√£o</label>
                <textarea id="body-{{ section.id }}" name="body" rows="3" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">{{ section.body }}</textarea>

                <label for="items-{{ section.id }}" style="font-weight: 600;">Itens (um por linha). Use "Texto | https://link" para definir o endere√ßo.</label>
                {% set ns = namespace(lines=[]) %}
                {% for item in section.items %}
                    {% set _ = ns.lines.append(item.label ~ (' | ' ~ item.url if item.url else '')) %}
                {% endfor %}
                <textarea id="items-{{ section.id }}" name="items" rows="5" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-size: 1rem;">{{ ns.lines | join('\n') }}</textarea>
            {% elif section.type == 'custom' %}
                <p style="color: var(--muted); font-size: 0.95rem;">
                    Utilize este bloco apenas se precisar de um layout muito espec√≠fico. O conte√∫do ser√° inserido diretamente como HTML.
                </p>
                <textarea id="html-{{ section.id }}" name="html" rows="10" style="padding: 12px 14px; border-radius: var(--radius); border: 1px solid #d3d8e6; font-family: 'Fira Code', 'Courier New', monospace; font-size: 0.95rem; line-height: 1.5;">{{ section.html }}</textarea>
            {% endif %}

            <button type="submit" style="align-self: flex-start; padding: 12px 18px; background: var(--primary); color: white; border: none; border-radius: var(--radius); font-size: 1rem; font-weight: 600; cursor: pointer;">Salvar bloco</button>
        </form>
    </div>
{% else %}
    <div class="card" style="text-align: center;">
        <p style="margin: 0; color: var(--muted);">Nenhum bloco cadastrado ainda. Utilize os modelos acima para come√ßar a construir a p√°gina.</p>
    </div>
{% endfor %}
{% endblock %}
